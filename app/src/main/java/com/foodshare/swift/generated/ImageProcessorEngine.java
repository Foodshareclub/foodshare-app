// Generated by jextract-swift
package com.foodshare.swift.generated;

import org.swift.swiftkit.core.annotations.*;

/**
 * Image processing engine from Swift ImageProcessorEngine.
 * Provides format detection, dimension extraction, hashing, and validation.
 */
@ThreadSafe
public final class ImageProcessorEngine {

    static {
        System.loadLibrary("FoodshareCore");
    }

    private ImageProcessorEngine() {
        // Static utility class
    }

    /**
     * Detect image format from raw bytes using magic bytes.
     * @param data Raw image bytes
     * @return Format string (jpeg, png, webp, heic, gif, bmp, tiff, unknown)
     */
    public static String detectFormat(byte[] data) {
        return $detectFormat(data, data.length);
    }

    /**
     * Extract image dimensions from raw bytes.
     * @param data Raw image bytes
     * @return SwiftImageDimensions with width and height
     */
    public static SwiftImageDimensions getDimensions(byte[] data) {
        long pointer = $getDimensions(data, data.length);
        return new SwiftImageDimensions(pointer);
    }

    /**
     * Generate SHA-256 content hash for duplicate detection.
     * @param data Raw image bytes
     * @return Hexadecimal hash string
     */
    public static String generateContentHash(byte[] data) {
        return $generateContentHash(data, data.length);
    }

    /**
     * Compare two hash strings.
     * @param hash1 First hash string
     * @param hash2 Second hash string
     * @return SwiftHashComparison with similarity and duplicate flag
     */
    public static SwiftHashComparison compareHashes(String hash1, String hash2) {
        long pointer = $compareHashes(hash1, hash2);
        return new SwiftHashComparison(pointer);
    }

    /**
     * Calculate Hamming distance between two hash strings at bit level.
     * @param hash1 First hash string
     * @param hash2 Second hash string
     * @return Number of differing bits
     */
    public static int hammingDistance(String hash1, String hash2) {
        return $hammingDistance(hash1, hash2);
    }

    /**
     * Validate image data against policy constraints.
     * @param data Raw image bytes
     * @param maxFileSize Maximum file size in bytes
     * @param maxDimension Maximum width/height
     * @param allowedFormats Comma-separated list of allowed formats
     * @return SwiftImageValidation with status and errors
     */
    public static SwiftImageValidation validateImage(
        byte[] data,
        int maxFileSize,
        int maxDimension,
        String allowedFormats
    ) {
        long pointer = $validateImage(data, data.length, maxFileSize, maxDimension, allowedFormats);
        return new SwiftImageValidation(pointer);
    }

    /**
     * Calculate target dimensions that fit within max bounds.
     * @param width Original width
     * @param height Original height
     * @param maxDimension Maximum dimension
     * @return SwiftImageDimensions with scaled dimensions
     */
    public static SwiftImageDimensions calculateTargetDimensions(
        int width,
        int height,
        int maxDimension
    ) {
        long pointer = $calculateTargetDimensions(width, height, maxDimension);
        return new SwiftImageDimensions(pointer);
    }

    // Native method declarations
    private static native String $detectFormat(byte[] data, int length);
    private static native long $getDimensions(byte[] data, int length);
    private static native String $generateContentHash(byte[] data, int length);
    private static native long $compareHashes(String hash1, String hash2);
    private static native int $hammingDistance(String hash1, String hash2);
    private static native long $validateImage(byte[] data, int length, int maxFileSize, int maxDimension, String allowedFormats);
    private static native long $calculateTargetDimensions(int width, int height, int maxDimension);
}
